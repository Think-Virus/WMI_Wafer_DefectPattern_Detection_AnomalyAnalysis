# Open-set Wafer Map Triage (WM-811K) β€” MVP ν”„λ΅μ νΈ

WM-811K(LSWMD.pkl) wafer map λ°μ΄ν„°λ΅  
1) **Known κ²°ν•¨ ν¨ν„΄ λ¶„λ¥**λ¥Ό ν•™μµν•κ³   
2) **ν•™μµμ— μ—†λ” κ²°ν•¨(Unknown)μ„ OOD μ μλ΅ νƒμ§€**ν•λ©°  
3) Unknown λ°μƒ μ‹ **μ μ‚¬μ‚¬λ΅€/κµ°μ§‘/μ‹κ°ν™”λ΅ νΈλ¦¬μ•„μ§€**λ¥Ό μ κ³µν•λ” κ²ƒμ„ λ©ν‘λ΅ ν•λ” ν”„λ΅μ νΈμ…λ‹λ‹¤.

> ν•µμ‹¬ μ»¨μ…‰: β€λ¶„λ¥ μ •ν™•λ„β€κ°€ μ•„λ‹λΌ **Unknownμ„ β€Unknownβ€™μΌλ΅ κ±°λ¶€(reject)ν•κ³  μ΄ν›„ λ€μ‘μ„ λ•λ” μ›ν¬ν”λ΅μ°**λ¥Ό κµ¬ν„ν•©λ‹λ‹¤.

---

## 1) ν”„λ΅μ νΈ λ©ν‘ (μ‘ν’/μ μ¶ κ΄€μ )
- λ‹¨μ wafer map λ¶„λ¥(Closed-set)λ” μ„ ν–‰ μ‚¬λ΅€κ°€ λ§μ•„ noveltyκ°€ μ•½ν•  μ μμ
- μ μ΅° ν„μ‹¤μ—μ„λ” **ν•™μµμ— μ—†λ μ‹ μΆ… κ²°ν•¨ ν¨ν„΄(Unknown)**μ΄ λ°μƒ κ°€λ¥
- λ³Έ ν”„λ΅μ νΈλ” λ‹¤μμ„ λ©ν‘λ΅ ν•¨
  - **Unknown κ³Όμ‹ (μλ»λ ν™•μ‹ ) μ¤λ¶„λ¥λ¥Ό μ¤„μ΄κ³ **
  - Unknown λ°μƒ ν›„ μ—”μ§€λ‹μ–΄κ°€ λΉ λ¥΄κ² νλ‹¨ν•λ„λ΅ **νΈλ¦¬μ•„μ§€(μ •λ¦¬/μμ‚¬κ²°μ • μ§€μ›)** μ κ³µ
- μ μ¶λ¬Ό: **μ‹μ—° μμƒ + ν¬μ¤ν„° + μ¬λΌμ΄λ“**

---

## 2) ν„μ¬ μƒνƒ (μ§„ν–‰ λ‹¨κ³„)
### β… MVP-1 (μ™„λ£): Known λ¶„λ¥ + OOD(Unknown νƒμ§€) ν‰κ°€
- labeled λ°μ΄ν„°(`failureType` μ΅΄μ¬)λ§ μ‚¬μ©
- ν΄λμ¤ ν™€λ“μ•„μ›ƒμΌλ΅ Open-set ν‰κ°€ κµ¬μ„± (μ: Donut/Scratch β†’ Unknown)
- ResNet18(κ²½λ‰ CNN) κΈ°λ° known λ¶„λ¥
- OOD μ μ **MSP vs Energy**λ΅ AUROC/AUPR ν‰κ°€
- μ²΄ν¬ν¬μΈνΈ μ €μ¥/λ΅λ“ μ ν‹Έ(Driveμ `checkpoints/`)

### π΅ MVP-2 (μ§„ν–‰μ¤‘): Triage(νΈλ¦¬μ•„μ§€) 2μ°¨ κµ¬ν„
- Unknown νμ • μ΄ν›„ νΈλ¦¬μ•„μ§€ κµ¬μ„± μ”μ†λ¥Ό λ‹¨κ³„μ μΌλ΅ μ¶”κ°€ μ¤‘
- β… **μ„λ² λ”© κΈ°λ° 2D μ‹κ°ν™”(UMAP)** κµ¬ν„
  - known vs unknown overlay μ‹κ°ν™” μ™„λ£
  - UMAPμ€ **μ¶• λ°©ν–¥/νμ „ μμ²΄λ” μλ―Έκ°€ μ—†κ³ **, κµ°μ§‘/μ΄μ›ƒ κ΄€κ³„λ¥Ό μ •μ„±μ μΌλ΅ ν™•μΈν•κΈ° μ„ν• λ©μ 
  - μ½”μ‚¬μΈ κΈ°λ° UMAP(`metric="cosine"`, `random_state=42`)λ„ μ¶”κ°€λ΅ ν™•μΈ
- β… **μ μ‚¬μ‚¬λ΅€ Top-K κ²€μƒ‰(μ„λ² λ”© κΈ°λ° retrieval)** κµ¬ν„
- β… λ°λ¨ μΌ€μ΄μ¤ μλ™ μ €μ¥: assets/triage/*.png, assets/triage/triage_summary.csv
-  β³ (κ°€λ¥ μ‹) **ν΄λ¬μ¤ν„°λ§**μΌλ΅ β€μ‹ κ· ν¨ν„΄ ν›„λ³΄κµ°β€ λ¬¶κΈ°

### β–¶ MVP-3 (κ°μ„ /κ³ λ„ν™”): μ„±λ¥ λ° OOD κ°•ν™”
- ν΄λμ¤ λ¶κ· ν• λ€μ‘(μƒν”λ¬/κ°€μ¤‘μΉ/μ†μ‹¤ν•¨μ)
- ν•΄μƒλ„ λΉ„κµ(64β†’96/128)
- pretrained backbone λΉ„κµ
- OOD κ°•ν™”: **μ„λ² λ”© κ±°λ¦¬(kNN distance)** κΈ°λ° OOD μ μ μ¶”κ°€

### (μ„ νƒ) ν™•μ¥ κ³Όμ 
- λΌλ²¨ λ¶€μ΅±μ„ ν™μ©ν•λ” μκΈ°μ§€λ„/λ°μ§€λ„ ν•™μµ(μ‹κ°„ μ—¬λ ¥ μ‹)

---

## 3) λ°μ΄ν„°μ…‹ λ° ν‰κ°€ μ„¤κ³„ (Open-set Protocol)
### λ°μ΄ν„°
- WM-811K (LSWMD.pkl)
- μ£Όμ” μ»¬λΌ:
  - `waferMap`: 2D numpy array (λ³΄ν†µ 0/1/2 κ°’)
  - `failureType`: κ²°ν•¨ λΌλ²¨(list ν•νƒ λλ” λΉ list)

### MVP-1 λ²”μ„
- `failureType`μ΄ μλ” μƒν”λ§ μ‚¬μ© (`failureType == []`λ” μ μ™Έ)

### Open-set κµ¬μ„±(ν΄λμ¤ ν™€λ“μ•„μ›ƒ)
- `UNKNOWN_CLASSES = ["Donut", "Scratch"]` (μμ‹)
- ν•™μµ/κ²€μ¦/ν…μ¤νΈ(known): ν™€λ“μ•„μ›ƒ μ μ™Έ ν΄λμ¤
- ν…μ¤νΈ(unknown): ν™€λ“μ•„μ›ƒ ν΄λμ¤λ§ λ¨μ•„ UnknownμΌλ΅ ν‰κ°€

> λ””νμ¤ ν¬μΈνΈ: WM-811Kμ—λ” μ›λ Unknown λΌλ²¨μ΄ μ—†μΌλ―€λ΅,  
> **β€ν•™μµμ—μ„ μ μ™Έν• ν΄λμ¤λ¥Ό UnknownμΌλ΅ κ°„μ£Όβ€**ν•μ—¬ κ°κ΄€μ μΌλ΅ ν‰κ°€ν•©λ‹λ‹¤.

---

## 4) κµ¬ν„ κ°μ” (MVP-1 / MVP-2 μΌλ¶€)
### λ¨λΈ (Known λ¶„λ¥)
- Backbone: `torchvision.models.resnet18` (weights=None) + `fc` μ¬μ •μ
- μ…λ ¥ μ „μ²λ¦¬:
  - wafer map β†’ (1, H, W) β†’ resize(κΈ°λ³Έ 64Γ—64, nearest)
  - ResNet μ…λ ¥ λ§μ¶”κΈ° μ„ν•΄ 1μ±„λ„μ„ 3μ±„λ„λ΅ λ³µμ 
- μ¦κ°•(Train only): μΆμ°/μƒν• flip + 90λ„ νμ „

### OOD(Unknown νƒμ§€)
- MSP(Max Softmax Probability)
- Energy score (logits κΈ°λ°)
- AUROC/AUPRλ΅ known vs unknown λ¶„λ¦¬ μ„±λ¥ ν‰κ°€

### Triage(νΈλ¦¬μ•„μ§€) β€” μ§„ν–‰μ¤‘(MVP-2)
- μ„λ² λ”© μ¶”μ¶: ResNet18μ fc μ§μ „ νΉμ§•(μ: avgpool μ¶λ ¥)μ„ ν™μ©
- 2D μ‹κ°ν™”: UMAPμΌλ΅ known/unknownμ λ¶„ν¬ λ° νΌμ¬ μ •λ„ ν™•μΈ

---

## 5) κ²°κ³Ό μ¤λƒ…μƒ· (ν„μ¬ λ² μ΄μ¤λΌμΈ, MVP-1)
### Known λ¶„λ¥ (test_known)
- macro-F1: **0.8715**
- κ΄€μ°°:
  - `none` ν΄λμ¤κ°€ λ§¤μ° λ§μ•„(μ§€μ› μƒν” μ νΌ) accuracy/weighted avgλ” λ†’κ² λ‚μ¬ μ μμ
  - `Loc`, `Edge-Loc` λ“± μΌλ¶€ κ²°ν•¨ ν΄λμ¤κ°€ μƒλ€μ μΌλ΅ μ•½ν•¨

### OOD(Unknown νƒμ§€) (test_unknown = holdout Donut/Scratch)
- AUROC (MSP): **0.8619**
- AUPR  (MSP): **0.9886** *(known=positive μ„¤μ • κΈ°μ¤€)*
- AUROC (Energy): **0.8524**
- AUPR  (Energy): **0.9877** *(known=positive μ„¤μ • κΈ°μ¤€)*

### (μ¶”κ°€) Triage μ‹κ°ν™”(UMAP) κ΄€μ°° β€” MVP-2 μ§„ν–‰μ¤‘
- unknownμ΄ known λ¶„ν¬μ™€ μΌλ¶€ μ„μ—¬ λ‚νƒ€λ‚λ” κ²½ν–¥μ΄ μμ–΄, λ‹¨μ β€μ™„μ „ λ¶„λ¦¬β€λ³΄λ‹¤λ”  
  **μ μ‚¬μ‚¬λ΅€ Top-K μ μ‹λ΅ μ‚¬λμ΄ λΉ λ¥΄κ² νλ‹¨ν•λ„λ΅ λ•λ” νΈλ¦¬μ•„μ§€** λ°©ν–¥μ΄ μ„¤λ“λ ¥ μμ.

---

## 6) (μ¤‘μ”) ν„μ¬ λ‹¨κ³„(MVP-1)μ ν•κ³„μ™€ κ°μ„  λ°©ν–¥
### 1) ν΄λμ¤ λ¶κ· ν• μν–¥μ΄ νΌ (`none` κ³Όλ‹¤)
- `none`μ΄ λ§μ•„ μ „μ²΄ accuracyκ°€ λ†’μ•„ λ³΄μΌ μ μμΌλ‚,
  κ²°ν•¨ ν΄λμ¤(μ: `Loc`, `Edge-Loc`) μ„±λ¥μ΄ μƒλ€μ μΌλ΅ λ‚®μ„ μ μμ.

**κ°μ„  λ°©ν–¥**
- `WeightedRandomSampler`λ΅ κ· ν• λ°°μΉ κµ¬μ„±(κ°€μ„±λΉ„ μµκ³ )
- λλ” class-weighted loss / focal loss μ μ©
- λ³΄κ³  μ§€ν‘λ” accuracyλ³΄λ‹¤ **macro-F1** μ¤‘μ‹¬ μ μ§€ (+ ν•„μ” μ‹ `none` μ μ™Έ macro-F1 λ³‘κΈ°)

### 2) Loc vs Edge-Loc λ“± μ μ‚¬ ν¨ν„΄ νΌλ™
- μ‹κ°μ μΌλ΅ μ μ‚¬ν• κ²°ν•¨μ€ μ¤λ¶„λ¥κ°€ λ°μƒν•  μ μμ.

**κ°μ„  λ°©ν–¥**
- resize 64 β†’ 96/128 λΉ„κµ
- pretrained backbone λΉ„κµ(κ°€λ¥ μ‹)

### 3) μ†μ ν΄λμ¤(Near-full λ“±) μ§€ν‘ λ³€λ™μ„±
- μƒν” μκ°€ λ§¤μ° μ μΌλ©΄ μ§€ν‘κ°€ ν”λ“¤λ¦΄ μ μμ.

**κ°μ„  λ°©ν–¥**
- seed κ³ μ • λ° λ°λ³µ μ‹¤ν—(μ—¬λ ¥ μ‹)
- ν™€λ“μ•„μ›ƒ μ΅°ν•© μ—¬λ¬ κ°λ΅ κ²€μ¦(ν™•μ¥ μ‹)

### 4) OODλ” λ² μ΄μ¤λΌμΈ(MSP/Energy) μμ¤€
- κµ¬ν„μ΄ κ°„λ‹¨ν• λ€μ‹ , λ°μ΄ν„°/λ¨λΈμ— λ”°λΌ ν•κ³„κ°€ μμ„ μ μμ.

**κ°μ„  λ°©ν–¥**
- μ„λ² λ”© κ±°λ¦¬(kNN distance) κΈ°λ° OOD μ μ μ¶”κ°€ (νΈλ¦¬μ•„μ§€μ™€ μμ—°μ¤λ½κ² μ—°κ²°)

### 5) ν„μ¬λ” β€νƒμ§€β€κΉμ§€ μ™„λ£, νΈλ¦¬μ•„μ§€λ” μ§„ν–‰μ¤‘(MVP-2)
- Unknownμ„ β€Unknownβ€μΌλ΅ νμ •ν•λ” λ‹¨κ³„λ” μ™„λ£(MVP-1)
- Unknown μ΄ν›„ β€μ •λ¦¬/μμ‚¬κ²°μ • μ§€μ›(νΈλ¦¬μ•„μ§€)β€λ” κµ¬ν„ μ§„ν–‰ μ¤‘(MVP-2)

---

## 7) μ‹¤ν–‰ λ°©λ²• (Google Colab κ¶μ¥)
1. Google Driveμ— `LSWMD.pkl`μ„ μ¤€λΉ„ν•©λ‹λ‹¤.
2. Colabμ—μ„ μ•„λ λ…ΈνΈλ¶μ„ μ—΄κ³  **Run all** μ‹¤ν–‰ν•©λ‹λ‹¤.
3. λ°μ΄ν„° κ²½λ΅(`pd.read_pickle(...)`)λ” λ³ΈμΈ Drive κµ¬μ΅°μ— λ§κ² μμ •ν•©λ‹λ‹¤.

λ…ΈνΈλ¶:
- `WMI_Wafer_DefectPattern_Detection_AnomalyAnalysis.ipynb`

---

## 8) μ²΄ν¬ν¬μΈνΈ(checkpoints) μ €μ¥ μ •μ±…
- λ¨λΈ μ²΄ν¬ν¬μΈνΈλ” Google Driveμ `checkpoints/` ν΄λ”μ— μ €μ¥ν•©λ‹λ‹¤.
- GitHubμ—λ” μ²΄ν¬ν¬μΈνΈλ¥Ό μ¬λ¦¬μ§€ μ•μµλ‹λ‹¤(λ ν¬ μ©λ‰/κ΄€λ¦¬ μ΄μ).
